<!DOCTYPE html>
<!--
    Copyright 2011, 2012 Ola SandstrÃ¶m.

    This file is part of Ricotta.

    Ricotta is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Ricotta is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Ricotta.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Ricotta</title>
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="css/DT_bootstrap.css" rel="stylesheet" media="screen">
        <link href="css/jquery.lightbox-0.5.css" rel="stylesheet"/>
        <link type="text/css" href="ricotta.custom.css" rel="stylesheet" />
        
        <!-- 
        <link type="text/css" href="css/blitzer/jquery-ui-1.8.17.custom.css" rel="stylesheet" />
         -->	
    </head>
    <body>
    	<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="navbar-inner">
        		<div class="container-fluid">
          			<a class="brand" href="javascript:home();">Ricotta</a>
          			<div class="nav-collapse collapse">
           				<ul class="nav navbar-text pull-right" id="headerUser">
           					<li><a id="headerUserAction" class="login" href="" >Login</a></li>
           					<li class="dropdown">
		         				<a class="dropdown-toggle" data-toggle="dropdown"><span class="icon-white icon-user"></span> <span id="headerUsername"></span> <b class="caret"></b></a>
		         				<ul class="dropdown-menu">
		         					<li class="active" data-target="projects"><a>Projects</a></li>
									<li data-target="templates"><a>Templates</a></li>
									<li data-target="languages"><a>Languages</a></li>
		         					<li class="divider"></li>
			         				<li><a id="headerUserAction" href="" >Logout</a></li>
		         				</ul>
           					</li>
           				</ul>
          			</div>
        		</div>
      		</div>
		</div>
	    <div class="container-fluid">
	    	<div id="ricotta_contents">
	    		<div id="toast"></div>
	    		<div id="welcome">
		    		<div>
		    			Ricotta is a translation management tool, with complimentary build tools, to efficiently manage localised resources in your software project.
		    			Manage translation of apps, websites and documents better.
		    		</div>
		    		<div id="footer">
		    			<p>
		    				a powerful solution for managing localization from start to finish.
		    			</p>
		    		</div>
	    		</div>
	    	</div>
			
    	</div><!--/.fluid-container-->
    	<!-- 
    	<footer class="footer">
		  	<div>Ricotta translations management tool.</div>
		  	<div>For Ricotta, the GNU General Public License version 3 applies, <a href="/LICENSE">GPLv3</a>.</div>
		</footer>  -->
		<!--       	
        <div id="contents" class="ui-widget"></div> -->
        <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/jquery.dataTables.js"></script>
        <script type="text/javascript" src="js/DT_bootstrap.js"></script>
        <script type="text/javascript" src="js/jquery.iframe-post-form.js"></script>
		<script type="text/javascript" src="js/jquery.lightbox-0.5.min.js"></script>
		<script type="text/javascript" src="ricotta_common.js"></script>
		<script type="text/javascript" src="ricotta_API.js"></script>
        <script type="text/javascript">
			$.ajaxSetup({
			    cache: false,
			    data: null,
			    async: true
			});
			var ajaxCalled = null;
			function home() {
				if(dataObject.tokenTable != null) {
					dataObject.tokenTable.fnClearTable();
					dataObject.tokenTable.fnDestroy();
				}
				arrayProjects = dataObject.projects;
				delete dataObject; 
				
				$(".project").remove();
				loadPage('projects');
			}
			function showToast(s) {
			    $("#toast").text(s).show();
			}
			
			function hideToast() {
			    $("#toast").text("").hide();
			}
			
			$(document).ready(function() {
			    showToast("Checking login status...");
			    ricottaAPI.me(success, fail);
			});
			
			function success(data) {
				$("#headerUser").data("json", data);
			    $("#headerUsername").text(data.email);
			    $(".dropdown-menu #headerUserAction").attr("href", data.url);
			    hideToast();
			    delete data;
			    $("#ricotta_contents").html("<div style='width:100%;text-align:center;'>Loading...</div>").load("home.html");
			    $(".pull-right #headerUserAction:first").hide();
			    $(".dropdown-menu li").live("click", function(){
			    	var page = $(this).data("target");//get the link page
			    	setActiveMenu($(".pull-right .dropdown-menu"), $(this));
			    	$(".project").remove();
			    	loadPage(page);
			    });
			}
			
			function fail(jqXHR) {
				$(".dropdown").hide();
				hideToast();
				
				//window.location.href= jqXHR.getResponseHeader("Login-Logout-URL");
				
			    //$("#headerUsername").text("Anonymous");
			    $(".pull-right #headerUserAction:first").attr("href", jqXHR.getResponseHeader("Login-Logout-URL"));
			    //$("#contents").html('<img src="/RicottaOverview.2.png" alt="Ricotta Overview" />');
			    //$("#ricotta_contents").append('<img src="/RicottaOverview.2.png" alt="Ricotta Overview" />');
			    
			}
			
			
			$(".dropdown-menu #headerUserAction").click(function(event) {
				//pause fire click event
				event.preventDefault();
				$('.projects').remove();
				$.ajax({
                    type: "GET",
                    url: "/api/me/v10/logout",
                    success: function(data) {
                    	//continue fire click event
                    	document.location.href=$(this).attr('href');
                    }
                });
			});
			
			
			//click on home link
			$("#headerHome").click(function() {
			    document.location = "index.html";
			});
			//click on project's name
			$("#headerProject").click(function() {
				$("#contents").empty();
				$("#ricotta_contents").html("<div style='width:100%;text-align:center;'>Loading...</div>").load("project.html");
			});
			
        </script>
    </body>
</html>
